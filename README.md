# Token Registry

[![npm version](https://badge.fury.io/js/@universal-packages%2Ftoken-registry.svg)](https://www.npmjs.com/package/@universal-packages/token-registry)
[![Testing](https://github.com/universal-packages/universal-token-registry/actions/workflows/testing.yml/badge.svg)](https://github.com/universal-packages/universal-token-registry/actions/workflows/testing.yml)
[![codecov](https://codecov.io/gh/universal-packages/universal-token-registry/branch/main/graph/badge.svg?token=CXPJSN8IGL)](https://codecov.io/gh/universal-packages/universal-token-registry)

Simple dictionary registry where keys are autogenerated secure tokens.

## Install

```shell
npm install @universal-packages/token-registry
```

## Registry

`Registry` is the main class interface to start registering data subjects to be retrieved later by their associated token.

```js
import { Registry } from '@universal-packages/token-registry'

const registry = new Registry()

const token = await registry.register({ id: 4 })

const myData = await registry.retrieve(token)

console.log(myData)

// > { id: 4 }
```

> By default a registry uses a memory engine to store data, this may not be suitable for production environments.

### Options

- **`engine`** `Engine`
  Instance of the engine to be used to store the data
- **`seed`** `String`
  Helps to add randomness to the token generation between instances

### Register `(subject: Object, category?: String)`

Registers a new data subject under a newly generated token and returns that new token, a category can optionally be passed to group the registered data subjects later.

```js
const token = await registry.register({ id: 4 })
```

### retrieve `(token: String)`

Returns the subject register under the provided token.

```js
const subject = await registry.retrieve(token)
```

### dispose `(token: String)`

Disposes the data subject registered under the provided token so it's no longer retrievable.

```js
await registry.dispose(token)
```

### update `(token: String, subject: Object)`

Sets or updates a data subject under the provided token.

> **WARNING:** You can pass any string as token so make sure to respect the internal secure token system.

```js
await registry.update(token, { id: 4, updated: true })
```

### categories `()`

Returns all teh categories in which subjects have been registered.

```js
const categories = await registry.categories()
```

### groupBy `(category: String)`

Returns all the subject under their tokens registered under the given category.

```js
const group = await registry.groupBy('group')

console.log(group)

// > { token: { data: 'example' }, token2: { data: 'example-2' } }
```

### clear `()`

Clears all registered data.

```js
await registry.clear()
```

## Engine

To create an engine that suits your requirements you just need to implement a new class as the following:

```js
import MyEngine from './MyEngine'

const registry = new Registry(new MyEngine())
```

```js
export default class MyEngine implements EngineInterface {
  clear() {
    // Clear the engine from all entries
  }

  set(token, subject, category) {
    // Store the subject using the token as key
    // You may need to serialize the subject manually
    // Manage category  for later grouping if present
  }

  get(token) {
    return // retrieve the subject from your engine using the token
  }

  delete(token) {
    // delete the entry from your engine using the token
  }

  getCategory(category) {
    // Return an object in the shape of { '${token}': subject }
    // Filter only the tokens that are attached to the category
  }

  listCategories() {
    // Keep track of all active categories and return them in an array
  }
}
```

### Engine Interface

If you are using TypeScript just can implement the `EngineInterface` to ensure the right implementation.

```ts
import { EngineInterface } from '@universal-packages/token-registry'

export default class MyEngine implements EngineInterface {}
```

## Typescript

This library is developed in TypeScript and shipped fully typed.

## Contributing

The development of this library happens in the open on GitHub, and we are grateful to the community for contributing bugfixes and improvements. Read below to learn how you can take part in improving this library.

- [Code of Conduct](./CODE_OF_CONDUCT.md)
- [Contributing Guide](./CONTRIBUTING.md)

### License

[MIT licensed](./LICENSE).
